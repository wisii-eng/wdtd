<xsl:template name="barcode-417"><xsl:param name="value"/><xsl:param name="string"/><xsl:param name="print-text" select="'false'"/><xsl:param name="text-color" select="'black'"/><xsl:param name="module" select="'0.33mm'"/><xsl:param name="wide-to-narrow" select="3.0"/><xsl:param name="height" select="'0.99mm'"/><xsl:param name="quiet-horizontal" select="'0.5mm'"/><xsl:param name="quiet-vertical" select="'0.5mm'"/><xsl:param name="font-family" select="'Arial'"/><xsl:param name="font-weight" select="'normal'"/><xsl:param name="font-style" select="'normal'"/><xsl:param name="font-height" select="'10pt'"/><xsl:param name="barcode-color" select="'black'"/><xsl:param name="text-block" select="'3.048mm'"/><xsl:param name="text-char-space" select="'0mm'"/><xsl:param name="orientation" select="0"/><xsl:param name="columns" select="0"/><xsl:param name="min-columns" select="1"/><xsl:param name="max-columns" select="30"/><xsl:param name="min-rows" select="3"/><xsl:param name="max-rows" select="90"/><xsl:param name="ec-level" select="0"/><xsl:call-template name="code417-draw-barcode"><xsl:with-param name="string"><xsl:choose><xsl:when test="string-length($string)=0"><xsl:value-of select="$value"/></xsl:when><xsl:otherwise><xsl:value-of select="$string"/></xsl:otherwise></xsl:choose></xsl:with-param><xsl:with-param name="print-text" select="$print-text"/><xsl:with-param name="text-color" select="$text-color"/><xsl:with-param name="module" select="$module"/><xsl:with-param name="wide-to-narrow" select="$wide-to-narrow"/><xsl:with-param name="height" select="$height"/><xsl:with-param name="quiet-horizontal" select="$quiet-horizontal"/><xsl:with-param name="quiet-vertical" select="$quiet-vertical"/><xsl:with-param name="font-family" select="$font-family"/><xsl:with-param name="font-weight" select="$font-weight"/><xsl:with-param name="font-style" select="$font-style"/><xsl:with-param name="font-height" select="$font-height"/><xsl:with-param name="barcode-color" select="$barcode-color"/><xsl:with-param name="text-block" select="$text-block"/><xsl:with-param name="text-char-space" select="$text-char-space"/><xsl:with-param name="orientation" select="$orientation"/><xsl:with-param name="value" select="$value"/><xsl:with-param name="columns" select="$columns"/><xsl:with-param name="min-columns" select="$min-columns"/><xsl:with-param name="max-columns" select="$max-columns"/><xsl:with-param name="min-rows" select="$min-rows"/><xsl:with-param name="max-rows" select="$max-rows"/><xsl:with-param name="ec-level" select="$ec-level"/></xsl:call-template></xsl:template><xsl:template name="code417-draw-barcode"><xsl:param name="string" select="''"/><xsl:param name="print-text" select="'true'"/><xsl:param name="text-color" select="black"/><xsl:param name="module" select="'0.33mm'"/><xsl:param name="wide-to-narrow" select="3.0"/><xsl:param name="height" select="'0.99mm'"/><xsl:param name="quiet-horizontal" select="'0.5mm'"/><xsl:param name="quiet-vertical" select="'0.5mm'"/><xsl:param name="font-family" select="'Arial'"/><xsl:param name="font-weight" select="normal"/><xsl:param name="font-style" select="normal"/><xsl:param name="font-height" select="'10pt'"/><xsl:param name="barcode-color" select="'black'"/><xsl:param name="text-block" select="'3.048mm'"/><xsl:param name="text-char-space" select="'0mm'"/><xsl:param name="orientation" select="0"/><xsl:param name="value" select="''"/><xsl:param name="columns" select="0"/><xsl:param name="min-columns" select="1"/><xsl:param name="max-columns" select="30"/><xsl:param name="min-rows" select="3"/><xsl:param name="max-rows" select="90"/><xsl:param name="ec-level" select="0"/><xsl:variable name="barcode-cfg"><xsl:call-template name="code417-config"><xsl:with-param name="value" select="$value"/><xsl:with-param name="module" select="$module"/><xsl:with-param name="wide-to-narrow" select="$wide-to-narrow"/><xsl:with-param name="height" select="$height"/><xsl:with-param name="quiet-horizontal" select="$quiet-horizontal"/><xsl:with-param name="quiet-vertical" select="$quiet-vertical"/><xsl:with-param name="columns" select="$columns"/><xsl:with-param name="min-columns" select="$min-columns"/><xsl:with-param name="max-columns" select="$max-columns"/><xsl:with-param name="min-rows" select="$min-rows"/><xsl:with-param name="max-rows" select="$max-rows"/><xsl:with-param name="ec-level" select="$ec-level"/></xsl:call-template></xsl:variable><xsl:variable name="bc" select="barcode:generate($barcode-cfg, $value)"/><xsl:variable name="bar-width"><xsl:value-of select="$bc/svg:svg/@width"/></xsl:variable><xsl:variable name="bar-height"><xsl:value-of select="$bc/svg:svg/@height"/></xsl:variable><xsl:variable name="bar-width-real"><xsl:call-template name="code417-convert-to-basic-units"><xsl:with-param name="length" select="$bar-width"/></xsl:call-template></xsl:variable><xsl:variable name="bar-height-real"><xsl:call-template name="code417-convert-to-basic-units"><xsl:with-param name="length" select="$bar-height"/></xsl:call-template></xsl:variable><xsl:variable name="text-block-real"><xsl:call-template name="code417-convert-to-basic-units"><xsl:with-param name="length" select="$text-block"/></xsl:call-template></xsl:variable><xsl:variable name="text-char-space-real"><xsl:call-template name="code417-convert-to-basic-units"><xsl:with-param name="length" select="$text-char-space"/></xsl:call-template></xsl:variable><xsl:variable name="quiet-vertical-real"><xsl:call-template name="code417-convert-to-basic-units"><xsl:with-param name="length" select="$quiet-vertical"/></xsl:call-template></xsl:variable><xsl:variable name="font-height-real"><xsl:call-template name="code417-convert-to-basic-units"><xsl:with-param name="length" select="$font-height"/></xsl:call-template></xsl:variable><xsl:variable name="line-height-real" select="round($font-height-real*1.2)*number($print-text='true')"/><xsl:variable name="area-width-real" select="$bar-width-real"/><xsl:variable name="area-height-real" select="$bar-height-real + $line-height-real + $text-block-real"/><xsl:variable name="code417-pi" select="3.141592653589793 div 180"/><xsl:variable name="area-width-real-transform"><xsl:value-of select="((math:abs(math:cos($orientation* $code417-pi)) * ($area-width-real div 2)) + (math:abs(math:sin($orientation* $code417-pi)) * ($area-height-real div 2))) * 2"/></xsl:variable><xsl:variable name="area-height-real-transform"><xsl:value-of select="((math:abs(math:sin($orientation * $code417-pi)) * ($area-width-real div 2)) + (math:abs(math:cos($orientation * $code417-pi)) * ($area-height-real div 2))) * 2"/></xsl:variable><xsl:variable name="area-x-transform"><xsl:value-of select="- math:sin($orientation * $code417-pi) * (($area-height-real-transform - $area-height-real) div 2) + math:cos($orientation * $code417-pi) * (($area-width-real-transform - $area-width-real) div 2)"/></xsl:variable><xsl:variable name="area-y-transform"><xsl:value-of select="math:cos($orientation * $code417-pi) * (($area-height-real-transform - $area-height-real) div 2) + math:sin($orientation * $code417-pi) * (($area-width-real-transform - $area-width-real) div 2)"/></xsl:variable><xsl:variable name="area-transform-string"><xsl:value-of select="concat('rotate(', - $orientation, ' ', ($area-width-real div 2) div 127, ' ', ($area-height-real div 2) div 127,') translate(', $area-x-transform div 127, ' ', $area-y-transform div 127, ')')"/></xsl:variable><svg:svg width="{concat($area-width-real-transform div 360, 'mm')}" height="{concat($area-height-real-transform div 360, 'mm')}"><desc><barcode value="{$value}" type="code417"/></desc><svg:g transform="{$area-transform-string}"><xsl:copy-of select="$bc"/><xsl:if test="$print-text='true'"><svg:text x="{concat(($area-width-real div 2) div 360, 'mm')}" y="{concat(($bar-height-real + $font-height-real + $text-block-real) div 360, 'mm')}" text-anchor="middle" font-family="{$font-family}" font-size="{concat($font-height-real div 360, 'mm')}" font-weight="{$font-weight}" font-style="{$font-style}" fill="{$text-color}"><svg:tspan letter-spacing="{$text-char-space-real div 127}"><xsl:value-of select="$string"/></svg:tspan></svg:text></xsl:if></svg:g></svg:svg></xsl:template><xsl:template name="code417-config"><xsl:param name="value" select="''"/><xsl:param name="module" select="'0.33mm'"/><xsl:param name="wide-to-narrow" select="3.0"/><xsl:param name="height" select="'0.99mm'"/><xsl:param name="quiet-horizontal" select="'0.5mm'"/><xsl:param name="quiet-vertical" select="'0.5mm'"/><xsl:param name="columns" select="0"/><xsl:param name="min-columns" select="1"/><xsl:param name="max-columns" select="30"/><xsl:param name="min-rows" select="3"/><xsl:param name="max-rows" select="90"/><xsl:param name="ec-level" select="0"/><xsl:variable name="module-real"><xsl:call-template name="code417-convert-to-basic-units"><xsl:with-param name="length" select="$module"/></xsl:call-template></xsl:variable><xsl:variable name="height-real"><xsl:call-template name="code417-convert-to-basic-units"><xsl:with-param name="length" select="$height"/></xsl:call-template></xsl:variable><xsl:variable name="quiet-horizontal-real"><xsl:call-template name="code417-convert-to-basic-units"><xsl:with-param name="length" select="$quiet-horizontal"/></xsl:call-template></xsl:variable><xsl:variable name="quiet-vertical-real"><xsl:call-template name="code417-convert-to-basic-units"><xsl:with-param name="length" select="$quiet-vertical"/></xsl:call-template></xsl:variable><barcode><description>PDF417 Default</description><msg><xsl:value-of select="$value"/></msg><pdf417><module-width><xsl:value-of select="concat($module-real div 360, 'mm')"/></module-width><row-height><xsl:value-of select="concat($height-real div 360, 'mm')"/></row-height><xsl:if test="$columns &gt; 0"><columns><xsl:value-of select="$columns"/></columns></xsl:if><min-columns><xsl:value-of select="$min-columns"/></min-columns><max-columns><xsl:value-of select="$max-columns"/></max-columns><min-rows><xsl:value-of select="$min-rows"/></min-rows><max-rows><xsl:value-of select="$max-rows"/></max-rows><ec-level><xsl:value-of select="$ec-level"/></ec-level><quiet-zone enabled="true"><xsl:value-of select="concat($quiet-horizontal-real div 360, 'mm')"/></quiet-zone><vertical-quiet-zone><xsl:value-of select="concat($quiet-vertical-real div 360, 'mm')"/></vertical-quiet-zone><width-to-height-ratio><xsl:value-of select="$wide-to-narrow"/></width-to-height-ratio></pdf417></barcode></xsl:template><xsl:template name="code417-convert-to-basic-units"><xsl:param name="length"/><xsl:variable name="length-numeric-value" select="translate ($length, 'ptxcinme ', '')"/><xsl:variable name="length-unit" select="translate ($length, '-0123456789. ', '')"/><xsl:variable name="length-scale-factor"><xsl:call-template name="code417-get-unit-scaling-factor"><xsl:with-param name="unit" select="$length-unit"/></xsl:call-template></xsl:variable><xsl:value-of select="round($length-numeric-value * $length-scale-factor)"/></xsl:template><xsl:template name="code417-get-unit-scaling-factor"><xsl:param name="unit"/><xsl:choose><xsl:when test="$unit = 'cm'">3600</xsl:when><xsl:when test="$unit = 'mm'">360</xsl:when><xsl:when test="$unit = 'in'">9144</xsl:when><xsl:when test="$unit = 'pt'">127</xsl:when><xsl:when test="$unit = 'pc'">1524</xsl:when><xsl:when test="$unit = 'em'"><xsl:text>1524</xsl:text></xsl:when><xsl:when test="$unit = 'ex'"><xsl:text>700</xsl:text></xsl:when><xsl:otherwise><xsl:text>360</xsl:text></xsl:otherwise></xsl:choose></xsl:template>